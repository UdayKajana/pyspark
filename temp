function splitMultilineRows() {
  // Get the active spreadsheet and sheet
  var sheet = SpreadsheetApp.getActiveSheet();
  var data = sheet.getDataRange().getValues();
  
  // Create a new sheet for the results
  var newSheet = SpreadsheetApp.getActiveSpreadsheet().insertSheet('Split Results');
  
  // Array to store the new rows
  var newData = [];
  
  // Process each row
  for (var i = 0; i < data.length; i++) {
    var row = data[i];
    var hasMultiline = false;
    var maxLines = 1;
    
    // Find the maximum number of lines in any cell of the row
    for (var j = 0; j < row.length; j++) {
      if (typeof row[j] === 'string') {
        var lines = row[j].split('\n');
        if (lines.length > 1) {
          hasMultiline = true;
          maxLines = Math.max(maxLines, lines.length);
        }
      }
    }
    
    // If row has multiline cells, split it
    if (hasMultiline) {
      for (var lineNum = 0; lineNum < maxLines; lineNum++) {
        var newRow = [];
        for (var j = 0; j < row.length; j++) {
          if (typeof row[j] === 'string') {
            var lines = row[j].split('\n');
            newRow.push(lines[lineNum] || ''); // Push empty string if no content
          } else {
            newRow.push(lineNum === 0 ? row[j] : ''); // Only keep value in first row
          }
        }
        newData.push(newRow);
      }
    } else {
      // If no multiline cells, keep row as is
      newData.push(row);
    }
  }
  
  // Write the results to the new sheet
  if (newData.length > 0) {
    newSheet.getRange(1, 1, newData.length, newData[0].length).setValues(newData);
    
    // Auto-resize columns
    newSheet.autoResizeColumns(1, newData[0].length);
  }
}

// Add menu item to run the script
function onOpen() {
  var ui = SpreadsheetApp.getUi();
  ui.createMenu('Split Tools')
    .addItem('Split Multiline Rows', 'splitMultilineRows')
    .addToUi();
}
