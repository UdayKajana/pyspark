function splitMultilineToNewSheet() {
  // Get the active spreadsheet
  var spreadsheet = SpreadsheetApp.getActiveSpreadsheet();
  var sourceSheet = spreadsheet.getActiveSheet();
  
  // Create new sheet with timestamp to avoid naming conflicts
  var timestamp = new Date().toISOString().replace(/[:.]/g, '_');
  var newSheet = spreadsheet.insertSheet('Split_Data_' + timestamp);
  
  // Get all data from columns A and B
  var lastRow = sourceSheet.getLastRow();
  var rangeA = sourceSheet.getRange("A1:A" + lastRow).getValues();
  var rangeB = sourceSheet.getRange("B1:B" + lastRow).getValues();
  
  // Array to hold all new rows
  var newData = [];
  
  // Process each row
  for (var row = 0; row < rangeA.length; row++) {
    var tablesList = rangeA[row][0];
    var dataset = rangeB[row][0];
    
    // Skip if either cell is empty
    if (!tablesList || !dataset) continue;
    
    // Split the multiline text into array
    var tables = tablesList.toString().split("\n");
    
    // Add each table as a new row
    for (var i = 0; i < tables.length; i++) {
      var tableName = tables[i].trim();
      if (tableName) {  // Only add non-empty lines
        newData.push([tableName, dataset]);
      }
    }
  }
  
  // Write headers
  newSheet.getRange(1, 1, 1, 2).setValues([['Table Name', 'Dataset']]);
  newSheet.getRange(1, 1, 1, 2).setFontWeight('bold');
  
  // Write all data at once if we have any
  if (newData.length > 0) {
    newSheet.getRange(2, 1, newData.length, 2).setValues(newData);
  }
  
  // Format the new sheet
  newSheet.autoResizeColumns(1, 2);
  
  // Add alternating row colors for better readability
  if (newData.length > 0) {
    newSheet.getRange(2, 1, newData.length, 2).applyRowBanding();
  }
  
  // Activate the new sheet
  newSheet.activate();
  
  // Show completion message
  SpreadsheetApp.getUi().alert(
    'Process Complete',
    'Created ' + newData.length + ' rows in new sheet "' + newSheet.getName() + '"',
    SpreadsheetApp.getUi().ButtonSet.OK
  );
}

// Add a custom menu to run the script
function onOpen() {
  var ui = SpreadsheetApp.getUi();
  ui.createMenu('Custom Scripts')
    .addItem('Split Multiline to New Sheet', 'splitMultilineToNewSheet')
    .addToUi();
}
